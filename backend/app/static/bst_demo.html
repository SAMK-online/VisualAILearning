<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive BST Visualizer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #121212;
            min-height: 100vh;
            padding: 20px;
            color: #EAEAEA;
        }

        .glassmorphism {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 900;
            letter-spacing: -0.033em;
        }

        .content {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .notes-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .canvas-container {
            border-radius: 1rem;
            padding: 24px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 500px;
        }

        canvas {
            max-width: 100%;
            max-height: 400px;
        }

        .traversal-output {
            margin-top: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            font-family: 'Courier New', monospace;
            color: #EAEAEA;
            min-height: 30px;
            font-weight: bold;
            border-left: 4px solid #4A90E2;
        }

        .controls {
            border-radius: 1rem;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 600px;
            overflow-y: auto;
        }

        .info-panel {
            border-radius: 1rem;
            padding: 24px;
            grid-column: 1 / -1;
        }

        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        input[type="number"] {
            flex: 1;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            font-size: 1em;
            background: rgba(255, 255, 255, 0.05);
            color: #EAEAEA;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.3);
        }

        button {
            padding: 10px 15px;
            background: #4A90E2;
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            flex: 1;
        }

        button:hover:not(:disabled) {
            background: #3a7bc8;
            transform: translateY(-1px);
        }

        button:active:not(:disabled) {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        button.danger {
            background: #ff6b6b;
        }

        button.danger:hover {
            background: #ee5a52;
        }

        button.success {
            background: #51cf66;
        }

        button.success:hover:not(:disabled) {
            background: #40c057;
        }

        .info-section {
            margin-bottom: 15px;
        }

        .info-section h3 {
            color: #4A90E2;
            margin-bottom: 8px;
            font-size: 1.1em;
            font-weight: 700;
        }

        .info-section p {
            color: #A0A0A0;
            line-height: 1.6;
            font-size: 0.95em;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .stat {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 0.5rem;
            border-left: 4px solid #4A90E2;
        }

        .stat-label {
            color: #A0A0A0;
            font-size: 0.85em;
            text-transform: uppercase;
            font-weight: bold;
        }

        .stat-value {
            color: #EAEAEA;
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 5px;
        }

        .legend {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
            color: #A0A0A0;
        }

        .legend-color {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 2px solid #333;
        }

        .example-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .example-buttons button {
            font-size: 0.9em;
            padding: 8px 12px;
        }

        .traversal-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .traversal-group button {
            font-size: 0.9em;
            padding: 8px 12px;
        }

        .traversal-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 0.5rem;
            border-left: 4px solid #4A90E2;
            font-size: 0.9em;
            color: #A0A0A0;
            line-height: 1.4;
            margin-top: 10px;
        }

        h3 {
            margin-top: 15px !important;
        }

        h3:first-of-type {
            margin-top: 0 !important;
        }

        /* Chat and Notes Styles */
        .chat-container {
            border-radius: 1rem;
            padding: 24px;
            display: flex;
            flex-direction: column;
            max-height: 600px;
        }

        .notes-container {
            border-radius: 1rem;
            padding: 24px;
            display: flex;
            flex-direction: column;
            max-height: 400px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 0.5rem;
            min-height: 300px;
            max-height: 400px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .message {
            margin-bottom: 12px;
            padding: 10px;
            border-radius: 8px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            background: #4A90E2;
            color: white;
            margin-left: 20px;
            text-align: right;
        }

        .message.ai {
            background: rgba(255, 255, 255, 0.05);
            color: #EAEAEA;
            margin-right: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .message.system {
            background: rgba(255, 255, 255, 0.03);
            color: #A0A0A0;
            text-align: center;
            font-style: italic;
            font-size: 0.9em;
        }

        .chat-input-group {
            display: flex;
            gap: 10px;
        }

        .chat-input-group input {
            flex: 1;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            font-size: 1em;
            background: rgba(255, 255, 255, 0.05);
            color: #EAEAEA;
        }

        .chat-input-group input::placeholder {
            color: #A0A0A0;
        }

        .chat-input-group input:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.3);
        }

        .chat-input-group button {
            padding: 10px 20px;
            background: #4A90E2;
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .chat-input-group button:hover:not(:disabled) {
            background: #3a7bc8;
        }

        .chat-input-group button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .notes-textarea {
            flex: 1;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 1em;
            resize: vertical;
            min-height: 200px;
            max-height: 300px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.03);
            color: #EAEAEA;
        }

        .notes-textarea::placeholder {
            color: #A0A0A0;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.3);
        }

        .notes-actions {
            display: flex;
            gap: 10px;
        }

        .notes-actions button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .notes-actions button.download {
            background: #51cf66;
            color: white;
        }

        .notes-actions button.download:hover {
            background: #40c057;
            transform: translateY(-2px);
        }

        .notes-actions button.clear {
            background: #ff6b6b;
            color: white;
        }

        .notes-actions button.clear:hover {
            background: #ee5a52;
        }

        .section-title {
            color: #4A90E2;
            margin-bottom: 15px;
            font-size: 1.2em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 11px 24px;
            background: rgba(255, 255, 255, 0.05);
            color: #EAEAEA;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            text-decoration: none;
            font-weight: bold;
            font-size: 1em;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .header-container h1 {
            margin: 0;
        }

        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }

            .header-container {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .back-button {
                width: 100%;
                justify-content: center;
            }

            .controls {
                max-height: none;
            }

            .chat-container, .notes-container {
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-container">
            <h1>üå≥ Binary Search Tree Visualizer with Traversals</h1>
            <a href="http://localhost:5173" class="back-button">
                ‚Üê Back to Home
            </a>
        </div>

        <div class="content">
            <div class="canvas-container glassmorphism">
                <canvas id="canvas"></canvas>
                <div class="traversal-output" id="traversalOutput">Select a traversal to visualize</div>
            </div>

            <div class="controls glassmorphism">
                <h3 style="color: #4A90E2;">Insert Node</h3>
                <div class="control-group">
                    <input type="number" id="valueInput" placeholder="Enter value" min="1" max="100">
                    <button onclick="insertNode()">Insert</button>
                </div>

                <h3 style="color: #4A90E2;">Quick Examples</h3>
                <div class="example-buttons">
                    <button onclick="insertExample1()" class="success">Example 1</button>
                    <button onclick="insertExample2()" class="success">Example 2</button>
                    <button onclick="insertExample3()" class="success">Random</button>
                </div>

                <h3 style="color: #4A90E2;">Traversals</h3>
                <div class="traversal-group">
                    <button onclick="startTraversal('inorder')" class="success" id="inorderBtn">In-Order</button>
                    <button onclick="startTraversal('preorder')" class="success" id="preorderBtn">Pre-Order</button>
                    <button onclick="startTraversal('postorder')" class="success" id="postorderBtn">Post-Order</button>
                    <button onclick="startTraversal('levelorder')" class="success" id="levelorderBtn">Level-Order</button>
                </div>
                <div class="traversal-info" id="traversalInfo">Load a tree first, then click a traversal button</div>

                <h3 style="color: #4A90E2;">Operations</h3>
                <button onclick="clearTree()" class="danger">Clear Tree</button>
            </div>

            <!-- Chat Section -->
            <div class="chat-container glassmorphism">
                <div class="section-title">
                    üí¨ Ask AI About BST
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message system">Ask me anything about Binary Search Trees! Try: "What is the time complexity?" or "When should I use a BST?"</div>
                </div>
                <div class="chat-input-group">
                    <input type="text" id="chatInput" placeholder="Ask a question..." />
                    <button onclick="sendMessage()" id="chatSendBtn">Send</button>
                </div>
            </div>
        </div>

        <!-- Notes Section - Full Width Row -->
        <div class="notes-row">
            <div class="notes-container glassmorphism">
                <div class="section-title">
                    üìù My Learning Notes
                </div>
                <textarea 
                    class="notes-textarea" 
                    id="notesTextarea" 
                    placeholder="Take notes as you learn about Binary Search Trees...&#10;&#10;Your notes are automatically saved in your browser!"
                ></textarea>
                <div class="notes-actions">
                    <button class="download" onclick="downloadNotes()">üì• Download</button>
                    <button class="clear" onclick="clearNotes()">üóëÔ∏è Clear</button>
                </div>
            </div>
        </div>

        <div class="info-panel glassmorphism">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 30px;">
                <div>
                    <div class="info-section">
                        <h3>üìö What is a BST?</h3>
                        <p>A Binary Search Tree is a data structure where each node has at most two children (left and right). For every node: all values in its left subtree are smaller, and all values in its right subtree are larger. This property enables fast search, insertion, and deletion.</p>
                    </div>
                </div>

                <div>
                    <div class="info-section">
                        <h3>üîÑ Traversals Explained</h3>
                        <p><strong>In-Order:</strong> Left ‚Üí Node ‚Üí Right (sorted order)<br>
                        <strong>Pre-Order:</strong> Node ‚Üí Left ‚Üí Right (parent first)<br>
                        <strong>Post-Order:</strong> Left ‚Üí Right ‚Üí Node (parent last)<br>
                        <strong>Level-Order:</strong> Top to bottom, left to right</p>
                    </div>
                </div>

                <div>
                    <div class="info-section">
                        <h3>üìä Current Tree Stats</h3>
                        <div class="stats">
                            <div class="stat">
                                <div class="stat-label">Total Nodes</div>
                                <div class="stat-value" id="nodeCount">0</div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">Tree Height</div>
                                <div class="stat-value" id="treeHeight">0</div>
                            </div>
                        </div>
                        <div class="legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background: #667eea;"></div>
                                <span>Normal</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #ffd700;"></div>
                                <span>Current</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #51cf66;"></div>
                                <span>Visited</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        class Node {
            constructor(value) {
                this.value = value;
                this.left = null;
                this.right = null;
                this.x = 0;
                this.y = 0;
                this.isNew = false;
                this.state = 'normal'; // 'normal', 'visiting', 'visited'
            }
        }

        class BST {
            constructor() {
                this.root = null;
            }

            insert(value) {
                if (this.root === null) {
                    this.root = new Node(value);
                    this.root.isNew = true;
                    return;
                }
                this._insertRec(this.root, value);
            }

            _insertRec(node, value) {
                if (value < node.value) {
                    if (node.left === null) {
                        node.left = new Node(value);
                        node.left.isNew = true;
                    } else {
                        this._insertRec(node.left, value);
                    }
                } else if (value > node.value) {
                    if (node.right === null) {
                        node.right = new Node(value);
                        node.right.isNew = true;
                    } else {
                        this._insertRec(node.right, value);
                    }
                }
            }

            getHeight(node = this.root) {
                if (node === null) return 0;
                return 1 + Math.max(this.getHeight(node.left), this.getHeight(node.right));
            }

            getNodeCount(node = this.root) {
                if (node === null) return 0;
                return 1 + this.getNodeCount(node.left) + this.getNodeCount(node.right);
            }

            resetStates(node = this.root) {
                if (!node) return;
                node.state = 'normal';
                node.isNew = false;
                this.resetStates(node.left);
                this.resetStates(node.right);
            }

            clear() {
                this.root = null;
            }
        }

        const bst = new BST();
        let isTraversing = false;
        let traversalSequence = [];

        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth - 40;
            canvas.height = Math.min(450, window.innerHeight - 300);
        }

        function drawTree() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (bst.root) {
                calculatePositions(bst.root, canvas.width / 2, 50, canvas.width / 4);
                drawNode(bst.root);
            }

            updateStats();
            requestAnimationFrame(drawTree);
        }

        function calculatePositions(node, x, y, offset) {
            if (!node) return;
            node.x = x;
            node.y = y;
            
            if (node.left) {
                calculatePositions(node.left, x - offset, y + 100, offset / 2);
            }
            if (node.right) {
                calculatePositions(node.right, x + offset, y + 100, offset / 2);
            }
        }

        function drawNode(node) {
            if (!node) return;

            // Draw edges
            if (node.left) {
                ctx.beginPath();
                ctx.moveTo(node.x, node.y);
                ctx.lineTo(node.left.x, node.left.y);
                ctx.strokeStyle = '#ccc';
                ctx.lineWidth = 2;
                ctx.stroke();
                drawNode(node.left);
            }

            if (node.right) {
                ctx.beginPath();
                ctx.moveTo(node.x, node.y);
                ctx.lineTo(node.right.x, node.right.y);
                ctx.strokeStyle = '#ccc';
                ctx.lineWidth = 2;
                ctx.stroke();
                drawNode(node.right);
            }

            // Determine node color
            let nodeColor = '#667eea';
            if (node.state === 'visiting') {
                nodeColor = '#ffd700';
            } else if (node.state === 'visited') {
                nodeColor = '#51cf66';
            }

            // Draw node circle
            const radius = 25;
            ctx.beginPath();
            ctx.arc(node.x, node.y, radius, 0, Math.PI * 2);
            ctx.fillStyle = nodeColor;
            ctx.fill();
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Draw node value
            ctx.fillStyle = 'white';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(node.value, node.x, node.y);

            // Reset new flag after animation
            setTimeout(() => {
                node.isNew = false;
            }, 800);
        }

        function updateStats() {
            document.getElementById('nodeCount').textContent = bst.getNodeCount();
            document.getElementById('treeHeight').textContent = bst.getHeight();
        }

        function insertNode() {
            const input = document.getElementById('valueInput');
            const value = parseInt(input.value);
            
            if (isNaN(value) || value < 1 || value > 100) {
                alert('Please enter a number between 1 and 100');
                return;
            }

            bst.insert(value);
            input.value = '';
            input.focus();
        }

        function insertExample1() {
            bst.clear();
            [50, 30, 70, 20, 40, 60, 80].forEach(val => bst.insert(val));
        }

        function insertExample2() {
            bst.clear();
            [45, 25, 65, 15, 35, 55, 75, 10, 30].forEach(val => bst.insert(val));
        }

        function insertExample3() {
            bst.clear();
            const values = [];
            for (let i = 0; i < 8; i++) {
                let val;
                do {
                    val = Math.floor(Math.random() * 100) + 1;
                } while (values.includes(val));
                values.push(val);
                bst.insert(val);
            }
        }

        function clearTree() {
            bst.clear();
            updateStats();
            document.getElementById('traversalOutput').textContent = 'Select a traversal to visualize';
            document.getElementById('traversalInfo').textContent = 'Load a tree first, then click a traversal button';
            isTraversing = false;
        }

        async function startTraversal(type) {
            if (isTraversing || !bst.root) return;
            
            isTraversing = true;
            bst.resetStates();
            traversalSequence = [];

            const descriptions = {
                inorder: 'In-Order (Left ‚Üí Node ‚Üí Right): Produces sorted output',
                preorder: 'Pre-Order (Node ‚Üí Left ‚Üí Right): Used for copying trees',
                postorder: 'Post-Order (Left ‚Üí Right ‚Üí Node): Used for deletion',
                levelorder: 'Level-Order (Top to Bottom): Breadth-first traversal'
            };

            document.getElementById('traversalInfo').textContent = descriptions[type];

            // Perform traversal with animation
            if (type === 'inorder') {
                await inorderTraversal(bst.root);
            } else if (type === 'preorder') {
                await preorderTraversal(bst.root);
            } else if (type === 'postorder') {
                await postorderTraversal(bst.root);
            } else if (type === 'levelorder') {
                await levelorderTraversal(bst.root);
            }

            document.getElementById('traversalOutput').textContent = traversalSequence.join(' ‚Üí ');
            isTraversing = false;
        }

        async function inorderTraversal(node) {
            if (!node) return;
            
            if (node.left) await inorderTraversal(node.left);
            
            node.state = 'visiting';
            await sleep(600);
            traversalSequence.push(node.value);
            node.state = 'visited';
            await sleep(400);
            
            if (node.right) await inorderTraversal(node.right);
        }

        async function preorderTraversal(node) {
            if (!node) return;
            
            node.state = 'visiting';
            await sleep(600);
            traversalSequence.push(node.value);
            node.state = 'visited';
            await sleep(400);
            
            if (node.left) await preorderTraversal(node.left);
            if (node.right) await preorderTraversal(node.right);
        }

        async function postorderTraversal(node) {
            if (!node) return;
            
            if (node.left) await postorderTraversal(node.left);
            if (node.right) await postorderTraversal(node.right);
            
            node.state = 'visiting';
            await sleep(600);
            traversalSequence.push(node.value);
            node.state = 'visited';
            await sleep(400);
        }

        async function levelorderTraversal(root) {
            const queue = [root];
            root.state = 'visiting';

            while (queue.length > 0) {
                const node = queue.shift();
                await sleep(600);
                traversalSequence.push(node.value);
                node.state = 'visited';
                await sleep(400);

                if (node.left) {
                    node.left.state = 'visiting';
                    queue.push(node.left);
                }
                if (node.right) {
                    node.right.state = 'visiting';
                    queue.push(node.right);
                }
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Event listener for Enter key
        document.getElementById('valueInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                insertNode();
            }
        });

        // ===================
        // CHAT FUNCTIONALITY
        // ===================
        
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const sendBtn = document.getElementById('chatSendBtn');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to chat
            addChatMessage(message, 'user');
            input.value = '';
            sendBtn.disabled = true;
            sendBtn.textContent = '...';
            
            try {
                // Get current tree context
                const context = {
                    tree_type: 'Binary Search Tree',
                    node_count: bst.getNodeCount(),
                    tree_height: bst.getHeight(),
                    traversal: document.getElementById('traversalInfo').textContent
                };
                
                // Send to backend API
                const response = await fetch('http://localhost:8000/api/chatbot', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        context: context
                    })
                });
                
                const data = await response.json();
                
                // Add AI response to chat
                addChatMessage(data.response || 'Sorry, I could not process that question.', 'ai');
                
            } catch (error) {
                console.error('Chat error:', error);
                addChatMessage('Sorry, there was an error connecting to the AI. Please try again.', 'ai');
            } finally {
                sendBtn.disabled = false;
                sendBtn.textContent = 'Send';
            }
        }
        
        function addChatMessage(text, type) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            chatMessages.appendChild(messageDiv);
            
            // Auto-scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Chat input Enter key listener
        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // ===================
        // NOTES FUNCTIONALITY
        // ===================
        
        const NOTES_STORAGE_KEY = 'bst_learning_notes';
        
        function downloadNotes() {
            const notes = document.getElementById('notesTextarea').value;
            
            if (!notes.trim()) {
                alert('Your notes are empty! Write something first.');
                return;
            }
            
            // Create blob with notes content
            const blob = new Blob([notes], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            // Create download link
            const a = document.createElement('a');
            a.href = url;
            const timestamp = new Date().toISOString().split('T')[0];
            a.download = `BST_Notes_${timestamp}.txt`;
            
            // Trigger download
            document.body.appendChild(a);
            a.click();
            
            // Cleanup
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Show confirmation
            addChatMessage('üì• Notes downloaded successfully!', 'system');
        }
        
        function clearNotes() {
            if (confirm('Are you sure you want to clear all notes? This cannot be undone.')) {
                document.getElementById('notesTextarea').value = '';
                localStorage.removeItem(NOTES_STORAGE_KEY);
                addChatMessage('üóëÔ∏è Notes cleared!', 'system');
            }
        }
        
        function saveNotes() {
            const notes = document.getElementById('notesTextarea').value;
            localStorage.setItem(NOTES_STORAGE_KEY, notes);
        }
        
        function loadNotes() {
            const savedNotes = localStorage.getItem(NOTES_STORAGE_KEY);
            if (savedNotes) {
                document.getElementById('notesTextarea').value = savedNotes;
            }
        }
        
        // Auto-save notes as user types (debounced)
        let notesTimeout;
        document.getElementById('notesTextarea').addEventListener('input', () => {
            clearTimeout(notesTimeout);
            notesTimeout = setTimeout(saveNotes, 1000); // Save after 1 second of inactivity
        });
        
        // Load notes on page load
        loadNotes();
        
        // Initialize
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        drawTree();
    </script>
</body>
</html>

